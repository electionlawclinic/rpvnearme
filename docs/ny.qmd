---
title: "NY"
description: |
  Ecological inference estimates by county for NY
format: html
---

```{r, echo = FALSE, message = FALSE, warning = FALSE}
library(tidyverse)
library(ggiraph)
library(ggdist)
library(patchwork)

alarm_abb <- function() {
  tibble::tribble(
    ~a, ~b,
    'pre', 'President',
    'uss', 'US Senate',
    'gov', 'Governor',
    'atg', 'Attorney General',
    'sos', 'Secretary of State'
  )
}
ei_tb <- read_csv('https://raw.githubusercontent.com/electionlawclinic/rpvnearme/main/data/NY_county_2020_summary.csv')

ei_tb <- ei_tb  |> 
  mutate(
    race = recode(
      race,
      'vap_black' = 'Black',
      'vap_hisp' = 'Hispanic',
      'vap_oth' = 'Other',
      'vap_white' = 'White'
    ),
    race = factor(race, levels = c('White', 'Black', 'Hispanic', 'Other'))
  ) |>
  filter(str_detect(cand, '_dem')) |>
  mutate(election = word(cand, sep = fixed('_')),
         election = recode(election, !!!deframe(alarm_abb())),
         year = 2000 + as.integer(str_sub(cand, 5, 6)),
         election = paste(election, year)) |>
  arrange(year, election) |>
  mutate(election = fct_inorder(election))

#ojs_define(ei_df = ei_tb)
```

```{r, echo = FALSE, message = FALSE, warning = FALSE}
lapply(ei_tb$county, function(cty) {
   ei_tb |>
    filter(county == cty) |>
    ggplot() +
    geom_interval(aes(y = election, x = mean, xmin = ci_95_lower, xmax = ci_95_upper, color = race),
                  position = position_dodge(width = .5)) +
    geom_pointinterval(aes(y = election, x = mean, xmin = mean, xmax = mean, group = race),
                       position = position_dodge(width = .5), color = 'black') +
    scale_x_continuous(name = 'Estimated Support for Democrats', labels = scales::percent, limits = c(0, 1)) +
    scale_y_discrete(name = 'Contest', limits = rev) +
    theme_bw() + 
    labs(title = cty)
})

```




<!-- ```{ojs} -->
<!-- ei = transpose(ei_df) -->
<!-- ``` -->


